{% extends "base.html" %}

{% block title %}–í–∞—à –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫{% endblock %}

{% block content %}
<h2>üìÖ –ú—ñ–π –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –ó–∞–≤–¥–∞–Ω—å</h2>
<hr>

<div class="card mb-4">
    <div class="card-header">
        <h4>üìù –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h4>
    </div>
    <div class="card-body">
        <form action="{{ url_for('add_task') }}" method="post" class="row g-3 align-items-center">
            <div class="col-md-6">
                <label for="content" class="visually-hidden">–¢–µ–∫—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è</label>
                <input type="text" class="form-control" id="content" name="content" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è —Ç—É—Ç..." required>
            </div>
            <div class="col-md-4">
                 <label for="category" class="visually-hidden">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                 <select name="category" id="category" class="form-select">
                     {% for cat_key, cat_name in categories.items() %}
                     <option value="{{ cat_key }}" {% if cat_key == 'general' %}selected{% endif %}>{{ cat_name }}</option>
                     {% endfor %}
                 </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">–î–æ–¥–∞—Ç–∏</button>
            </div>
        </form>
    </div>
    
    <div class="mt-4 mb-4 text-center">
        <a href="{{ url_for('export_tasks') }}" class="btn btn-secondary">üìã –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è –≤ —Ç–µ–∫—Å—Ç</a>
    </div>
    
</div>


<div class="row">
  {% for category_key, category_name in categories.items() %}
    <div class="col-lg-6 mb-4"> <div class="category-section">
            <h3 class="category-title">{{ category_name }}</h3>
            {% set tasks = tasks_by_category[category_key] %}
            {% if tasks %}
                <ul class="list-unstyled">
                    {% for task in tasks %}
                    <li class="task-item {% if task.is_completed %}completed{% endif %}">
                        <span class="task-content">{{ task.content }}</span>
                        <div class="task-actions">
                            <form action="{{ url_for('toggle_task', task_id=task.id) }}" method="post">
                                <button type="submit" class="btn btn-sm {% if task.is_completed %}btn-secondary{% else %}btn-success{% endif %}">
                                    {% if task.is_completed %}‚Ü©Ô∏è{% else %}‚úîÔ∏è{% endif %}
                                </button>
                            </form>
                            <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                            <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è?');">
                                <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è</button>
                            </form>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">–ù–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.</p>
            {% endif %}
        </div>
    </div>
  {% endfor %}
</div>

{% endblock %}
