{% extends "base.html" %}

{% block title %}–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–¥–∞–Ω—å{% endblock %}

{% block content %}
<h2>üìã –ï–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–¥–∞–Ω—å —É —Ç–µ–∫—Å—Ç</h2>
<hr>

<div class="card">
    <div class="card-header">–í–∞—à —Å–ø–∏—Å–æ–∫ –∑–∞–≤–¥–∞–Ω—å</div>
    <div class="card-body">
        <p>–ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –≤–∞—à –ø–æ—Ç–æ—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞–≤–¥–∞–Ω—å —É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ. –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –π–æ–≥–æ —Ç–∞ –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≤ Telegram.</p>
        <div class="mb-3">
            <textarea id="exportTextArea" class="form-control" rows="15" readonly>{{ export_text }}</textarea>
        </div>
        <button id="copyButton" class="btn btn-primary" onclick="copyText()">üìÑ –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>
        <a href="{{ url_for('planner') }}" class="btn btn-secondary">–ù–∞–∑–∞–¥ –¥–æ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function copyText() {
        const textArea = document.getElementById('exportTextArea');
        const copyButton = document.getElementById('copyButton');
        textArea.select();
        textArea.setSelectionRange(0, 99999); // For mobile devices
        try {
            navigator.clipboard.writeText(textArea.value).then(() => {
                copyButton.textContent = '‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                copyButton.classList.remove('btn-primary');
                copyButton.classList.add('btn-success');
                setTimeout(() => {
                    copyButton.textContent = 'üìÑ –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç';
                    copyButton.classList.remove('btn-success');
                    copyButton.classList.add('btn-primary');
                }, 2000);
            }).catch(err => {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è (Clipboard API): ', err);
                fallbackCopyTextToClipboard(textArea.value);
            });
        } catch (err) {
             console.error('Clipboard API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è: ', err);
             fallbackCopyTextToClipboard(textArea.value);
        }
    }
    function fallbackCopyTextToClipboard(text) {
        const copyButton = document.getElementById('copyButton');
        // –¶–µ–π –º–µ—Ç–æ–¥ –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ —É—Å—ñ—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö, –æ—Å–æ–±–ª–∏–≤–æ –≤ webview
        try {
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç textarea
            const tempTextArea = document.createElement("textarea");
            tempTextArea.value = text;
            tempTextArea.style.position = "absolute"; // –•–æ–≤–∞—î–º–æ –π–æ–≥–æ
            tempTextArea.style.left = "-9999px";
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            const successful = document.execCommand('copy');
            document.body.removeChild(tempTextArea); // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç

            if (successful) {
                copyButton.textContent = '‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                copyButton.classList.remove('btn-primary');
                copyButton.classList.add('btn-success');
                 setTimeout(() => {
                    copyButton.textContent = 'üìÑ –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç';
                    copyButton.classList.remove('btn-success');
                    copyButton.classList.add('btn-primary');
                }, 2000);
            } else {
                 copyButton.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è';
                 copyButton.classList.remove('btn-primary');
                 copyButton.classList.add('btn-danger');
                 console.error('Fallback: –ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏');
            }
        } catch (err) {
            copyButton.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è';
            copyButton.classList.remove('btn-primary');
            copyButton.classList.add('btn-danger');
            console.error('Fallback: –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—ñ', err);
        }
    }
</script>
{% endblock %}
